<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Legendary Video Editor</title>
<style>
body { margin:0; font-family: Arial, sans-serif; background:#121212; color:#fff; }
header { text-align:center; font-size:28px; color:#00ffff; padding:10px; text-shadow:0 0 5px #00ffff; }
#video { width:100%; max-height:300px; margin-bottom:10px; background:#000; }
.controls { display:flex; flex-wrap:wrap; gap:10px; margin:10px; justify-content:center; }
button, input[type=range] { padding:10px; border:none; border-radius:5px; cursor:pointer; }
button { background:#00ffff; color:#121212; font-weight:bold; }
button:hover { background:#00dddd; }
input[type=range] { width:150px; }
.panel { margin:10px; display:flex; flex-wrap:wrap; gap:10px; justify-content:center; }
</style>
</head>
<body>
<header>Legendary Video Editor</header>
<video id="video" controls></video>

<div class="controls">
<button id="upload">Choose Video</button>
<button id="trim">Trim 5-10s</button>
<button id="speed">Speed 2x</button>
<button id="pitch">Pitch +2</button>
<button id="echo">Echo</button>
<button id="brightness">Brightness +0.1</button>
<button id="export">Export MP4</button>
</div>

<div class="panel">
<label>Playback Speed:</label>
<input type="range" id="volume" min="0.5" max="2" step="0.1" value="1">
</div>

<script type="module">
import { createFFmpeg, fetchFile } from 'https://cdn.jsdelivr.net/npm/@ffmpeg/ffmpeg@0.11.1/dist/ffmpeg.min.js';

const ffmpeg = createFFmpeg({ log:true });
let fileData;
let isLoaded = false;
const video = document.getElementById('video');

const loadFFmpegOnce = async () => {
  if(!isLoaded){
    await ffmpeg.load();
    isLoaded = true;
  }
}

// Upload Video
document.getElementById('upload').onclick = () => {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = 'video/*';
  input.onchange = async e => {
    fileData = e.target.files[0];
    video.src = URL.createObjectURL(fileData);
  };
  input.click();
}

// Helper to process video
const processVideo = async (ffmpegArgs) => {
  if(!fileData){alert("Upload a video first"); return;}
  await loadFFmpegOnce();
  ffmpeg.FS('writeFile','input.mp4',await fetchFile(fileData));
  await ffmpeg.run(...ffmpegArgs);
  const data = ffmpeg.FS('readFile','output.mp4');
  const url = URL.createObjectURL(new Blob([data.buffer], { type:'video/mp4' }));
  video.src = url;
  fileData = new File([data.buffer],'output.mp4',{ type:'video/mp4' });
}

// Trim 5-10s
document.getElementById('trim').onclick = async () => {
  await processVideo(['-i','input.mp4','-ss','5','-to','10','-c','copy','output.mp4']);
}

// Speed 2x
document.getElementById('speed').onclick = async () => {
  await processVideo(['-i','input.mp4','-filter:v','setpts=0.5*PTS','output.mp4']);
}

// Pitch +2
document.getElementById('pitch').onclick = async () => {
  await processVideo(['-i','input.mp4','-af','asetrate=44100*1.2,aresample=44100','output.mp4']);
}

// Echo
document.getElementById('echo').onclick = async () => {
  await processVideo(['-i','input.mp4','-af','aecho=0.8:0.9:1000:0.3','output.mp4']);
}

// Brightness +0.1
document.getElementById('brightness').onclick = async () => {
  await processVideo(['-i','input.mp4','-vf','eq=brightness=0.1','output.mp4']);
}

// Export
document.getElementById('export').onclick = () => {
  if(!fileData){alert("No video to export"); return;}
  const url = URL.createObjectURL(fileData);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'edited_video.mp4';
  a.click();
}

// Playback speed slider
document.getElementById('volume').oninput = e => {
  video.playbackRate = parseFloat(e.target.value);
}
</script>
</body>
</html>
